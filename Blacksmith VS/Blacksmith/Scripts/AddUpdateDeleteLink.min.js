(function(){var n,t,i;$(function(){return t(),setInterval(t,59e3),i()});t=function(){var u,t,f,i,r;for(i=$(".date.difference"),r=[],t=0,f=i.length;t<f;t++)u=i[t],r.push(n($(u)));return r};n=function(n){var i,t;return i=n.attr("abs-date"),t=moment(i,"DD-MMM-YY HH:mm:ss").fromNow(),t!=="Invalid date"?n.text(t):void 0};i=function(){var n,f,i,t,e,r,u;for(r=$("[contenteditable]"),u=[],t=0,e=r.length;t<e;t++)f=r[t],n=$(f),i=n.text().trim(),n.data("original",i),u.push(n.data("db-cache",i));return u};this.focused;this.registerFocus=function(n,t){return this.focused={id:n,type:t}};this.updateFocused=function(){var t,f,r,h,n,e,o,u,s,i;if(o=this.focused.id,i=this.focused.type,i!=="title"&&i!=="address"&&i!=="description"){console.error("Invalid focused type: "+i);return}if(r=$("[db-id='"+o+"']"),n=r.find("."+i),t=n.text().trim(),u=r.find(".working-indicator"),s=n.data("last-content"),t===n.data("db-cache")){!n.data("update-timeout")||clearTimeout(n.data("update-timeout"));u.css("visibility","hidden");return}if(s==null||s!==t)return n.data("last-content",t),i==="address"&&(r.find(".favicon").attr("src","http://www.google.com/s2/favicons?domain_url="+t),r.find(".visit-link").attr("title","Visit "+t).attr("href",""+prependHttp(t))),u.css("visibility","visible"),f=r.find(".date.difference"),e=moment().format("DD-MMM-YY HH:mm:ss"),f.attr("abs-date",e).attr("title","Date updated: "+e),!n.data("update-timeout")||clearTimeout(n.data("update-timeout")),h=function(){return updateDB(i,t,o,u,f,n)},n.data("update-timeout",setTimeout(h,2e3))};this.prependHttp=function(n){var i,t;return(t="http://",i=n.slice(0,t.length),i!==t)?t+n:n};this.updateDB=function(t,i,r,u,f,e){return console.log("updatin "+t+" to "+i+" for id "+r),$.ajax({url:"Manage?Action=Update&field="+t+"&value="+i+"&id="+r}).done(function(){return e.data("db-cache",i),u.css("visibility","hidden"),n(f),console.log("done updating!")})};this.sendInsert=function(){var t,i,n,r;return n=$("#creation"),r=n.find(".title").text().trim(),t=n.find(".address").text().trim(),i=n.find(".description").text().trim(),$.ajax({url:"Manage?Action=Insert&title="+r+"&address="+t+"&description="+i}).done(function(){return console.log("done inserting!")})};this.sendDelete=function(n){return $.ajax({url:"Manage?Action=Delete&id="+n}).done(function(){return $("[db-id='"+n+"']").slideUp(),console.log("done deleting!")})}}).call(this);