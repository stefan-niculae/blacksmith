(function(){var n,t;$(function(){var r,t,u,i;for(i=$("#submitted article"),t=0,u=i.length;t<u;t++)r=i[t],n($(r));return setInterval(convertDates,59e3)});n=function(n){var f,i,e,r,u;for(convertDate(n.find(".date.difference")),r=n.find("[allows-edit]"),u=[],i=0,e=r.length;i<e;i++)f=r[i],u.push(t($(f)));return u};t=function(n){var t;return t=n.text().trim(),n.data("original",t),n.data("db-cache",t)};this.focused;this.registerFocus=function(n,t){return this.focused={id:n,type:t}};this.updateFocused=function(){var i,f,r,h,n,e,o,u,s,t;if(o=this.focused.id,t=this.focused.type,t!=="title"&&t!=="address"&&t!=="description"){console.error("Invalid focused type: "+t);return}if(r=$("[db-id='"+o+"']"),n=r.find("."+t),i=n.text().trim(),u=r.find(".working-indicator"),s=n.data("last-content"),i===n.data("db-cache")){!n.data("update-timeout")||clearTimeout(n.data("update-timeout"));u.css("visibility","hidden");return}if(s==null||s!==i)return n.data("last-content",i),t==="address"&&(r.find(".favicon").attr("src","http://www.google.com/s2/favicons?domain_url="+i),r.find(".address a").attr("href",""+prependHttp(i))),u.css("visibility","visible"),f=r.find(".date.difference"),e=moment().format("DD-MMM-YY HH:mm:ss"),f.attr("abs-date",e).attr("title","Date updated: "+e),!n.data("update-timeout")||clearTimeout(n.data("update-timeout")),h=function(){return updateDB(t,i,o,u,f,n)},n.data("update-timeout",setTimeout(h,1e3))};this.prependHttp=function(n){var i,t;return(t="http://",i=n.slice(0,t.length),i!==t)?t+n:n};this.updateDB=function(n,t,i,r,u,f){return $.ajax({url:""+window.location.href+"&Action=Update&field="+n+"&value="+t+"&id="+i}).done(function(){return f.data("db-cache",t),r.css("visibility","hidden"),convertDate(u),console.log("done updating!")})};this.sendDelete=function(){var n,t;return n=$(event.currentTarget).parent("article"),t=n.attr("db-id"),$.ajax({url:""+window.location.href+"&Action=Delete&id="+t}).done(function(){return n.slideUp(),console.log("done deleting!")})};this.toggleEditable=function(){var n,t,i;return n=$(event.currentTarget).parent("article"),t=n.find("[allows-edit][contenteditable]"),i=n.find("[allows-edit]:not([contenteditable])"),t.removeAttr("contenteditable"),i.attr("contenteditable","")}}).call(this);