(function(){var n,t,i,r;$(function(){var u,n,f,r;for(r=$("#submitted article"),n=0,f=r.length;n<f;n++)u=r[n],i($(u));return setInterval(t,59e3)});i=function(t){var e,i,o,u,f;for(n(t.find(".date.difference")),u=t.find("[allows-edit]"),f=[],i=0,o=u.length;i<o;i++)e=u[i],f.push(r($(e)));return f};t=function(){var u,t,f,i,r;for(i=$(".date.difference"),r=[],t=0,f=i.length;t<f;t++)u=i[t],r.push(n($(u)));return r};n=function(n){var i,t;return i=n.attr("abs-date"),t=moment(i,"DD-MMM-YY HH:mm:ss").fromNow(),t!=="Invalid date"?n.text(t):void 0};r=function(n){var t;return t=n.text().trim(),n.data("original",t),n.data("db-cache",t)};this.focused;this.registerFocus=function(n,t){return this.focused={id:n,type:t}};this.updateFocused=function(){var t,f,r,h,n,e,o,u,s,i;if(o=this.focused.id,i=this.focused.type,i!=="title"&&i!=="address"&&i!=="description"){console.error("Invalid focused type: "+i);return}if(r=$("[db-id='"+o+"']"),n=r.find("."+i),t=n.text().trim(),u=r.find(".working-indicator"),s=n.data("last-content"),t===n.data("db-cache")){!n.data("update-timeout")||clearTimeout(n.data("update-timeout"));u.css("visibility","hidden");return}if(s==null||s!==t)return n.data("last-content",t),i==="address"&&(r.find(".favicon").attr("src","http://www.google.com/s2/favicons?domain_url="+t),r.find(".visit-link").attr("title","Visit "+t).attr("href",""+prependHttp(t))),u.css("visibility","visible"),f=r.find(".date.difference"),e=moment().format("DD-MMM-YY HH:mm:ss"),f.attr("abs-date",e).attr("title","Date updated: "+e),!n.data("update-timeout")||clearTimeout(n.data("update-timeout")),h=function(){return updateDB(i,t,o,u,f,n)},n.data("update-timeout",setTimeout(h,1e3))};this.prependHttp=function(n){var i,t;return(t="http://",i=n.slice(0,t.length),i!==t)?t+n:n};this.updateDB=function(t,i,r,u,f,e){return $.ajax({url:""+window.location.href+"&Action=Update&field="+t+"&value="+i+"&id="+r}).done(function(){return e.data("db-cache",i),u.css("visibility","hidden"),n(f),console.log("done updating!")})};this.sendDelete=function(){var n;return n=$(event.currentTarget).parent("article"),$.ajax({url:""+window.location.href+"&Action=Delete&id="+id}).done(function(){return n.slideUp(),console.log("done deleting!")})};this.toggleEditable=function(){var n,t,i;return n=$(event.currentTarget).parent("article"),t=n.find("[allows-edit][contenteditable]"),i=n.find("[allows-edit]:not([contenteditable])"),t.removeAttr("contenteditable"),i.attr("contenteditable","")}}).call(this);